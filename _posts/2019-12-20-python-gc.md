---
layout: post
title: 파이선 GC(Garbege Collector)의 작동방식
tags: [Python, GC]
categories: [Python]
---

파이선 GC는 [참조횟수 계산방식(reference counting)]([https://ko.wikipedia.org/wiki/%EC%B0%B8%EC%A1%B0_%ED%9A%9F%EC%88%98_%EA%B3%84%EC%82%B0_%EB%B0%A9%EC%8B%9D](https://ko.wikipedia.org/wiki/참조_횟수_계산_방식))으로 작동한다. 참조횟수 계산방식에 대한 위키피디아의 설명은 다음과 같다.

> **참조 횟수 계산 방식**(reference counting)은 메모리를 제어하는 방법 중 하나로, [쓰레기 수집](https://ko.wikipedia.org/wiki/쓰레기_수집_(컴퓨터_과학))의 한 방식이다. 구성 방식은 단순하다. 어떤 한 동적 단위(객체, Object)가 참조값을 가지고 이 단위 객체가 참조(참조 복사)되면 참조값을 늘리고 참조한 다음 더이상 사용하지 않게 되면 참조값을 줄이면 된다. 보통 참조값이 0이 되면 더이상 유효한 단위 객체로 보지 않아 메모리에서 제거한다.

간단하게 말하자면 모든 객체는 참조값을 가진다. 해당 객체가 참조되면 참조값을 늘어난다. 객체가 더이상 사용하지 않으면 참조값을 줄어든다. 참조값이 0이되면 메모리에서 제거한다. 

단점은 참조할 때 마다 참조값을 검사해야 하기 때문에, 검사 부하가 커진다. 참조하는 단위 객체들이 서로 참조하면 순환 참조 오류가 발생해, 잘못된 참조 파괴가 생기거나 단위객체가 고아(orphaned)가 될 수 있다. 순환 참조일 경우 이미 참조가 끝났더라도 참조값은 계속 1이다. 

이 문제를 해결하기 위해서 파이선은 추가적인 GC 방식을 도입했다. `gcmodule.c`의 `gc.collect()`가 참조횟수 방식을 사용해서는 접근과 해제가 불가능한 객체를 해제한다. 이 방식은 [Mark and sweep algorithm(표시하고 쓸기)](https://www.geeksforgeeks.org/mark-and-sweep-garbage-collection-algorithm/), 방식이다. 

>표시하고 쓸기 기법은 포인터 추적 기법 가운데 가장 단순한 기법이다. 먼저 각 메모리 할당 영역에 표시를 위해 1 [비트](https://ko.wikipedia.org/wiki/비트_(단위))의 메모리를 남겨 둔다. 표시 단계에서, 모든 변수가 가리키는 영역을 "사용 중"으로 표시하고, 그 영역에서 가리키는 또다른 영역 또한 "사용 중"으로 표시한다. 이와 같이 모든 메모리 영역을 표시하고 나면, 표시되지 않은 영역을 접근 불가능한 메모리 영역이 된다. 접근 불가능한 메모리 영역들을 쓸기 단계에서 모두 해제한다.
>
>이 기법의 단점은, 표시 단계에서 메모리 내용이 변경되지 않아야 하기 때문에 전체 시스템의 실행이 정지된다는 것이다. 또한 전체 메모리 영역을 검사해야 하므로 메모리 [페이징](https://ko.wikipedia.org/wiki/페이징)을 사용하는 운영체제에서 프로그램의 성능이 저하될 수 있다.

