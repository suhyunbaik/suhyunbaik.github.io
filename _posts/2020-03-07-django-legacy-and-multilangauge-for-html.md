---
title: Django 레거시 프로젝트에 html 파일 하나를 위해 multi langauge support 추가하기
layout: page
tags: [Django, Localization]
categories: [django]
---


목차

1. 기존 다국어 지원 방식
2. 문제
3. 해결
4. 후속 조치



##### 1. 기존 다국어 지원 방식

현재 개발하고 있는 서비스를 간략히 소개하자면 한국어, 영어, 일본어, 프랑스어, 러시아어, 스페인어, 이탈리아어 등 거의 22개국 어를 지원하는 다국어 서비스다. 서버는 Django로 구성됐는데 Django의 기능 중 하나인 I18N(Internationalization)은 사용하지 않는다. 

언어별 지원이 필수인 푸시 메제지의 경우,  json 또는 다양한 형태의 파일로 만들어서 서버에서 갖고 있다가 유저의 언어별로 해당하는 스트링을 찾아 푸시를 보낸다.



##### 2. 문제

이번에 추가되는 기능은 이메일을 사용한다. html 이메일을 보내야 하는데 유저의 사용 언어에 따라 맞는 언어로 번역된 이메일을 발송해야 한다. 그래서 이번에 django 다국어 지원을 써보려고 하는데, 번역할 텍스트 목록 파일 생성시 문제가 발생했다. 번역할 텍스트 목록 현재 파이선 버전이 2.X이라서 파일마다 첫줄에 주석으로 인코딩 명시가 되어있다. 

```python
#-*- coding:utf-8 -*-
```

그런데 이 주석에 스페이스가 없거나 엉뚱한 자리에 스페이스가 들어가 있는 파일들이 많은데 그런 파일들이 `python manage.py makemessages` 명령어를 날려서 텍스트 목록 파일을 생성하는 작업중에 오류를 발생시켜서 죽는 것이다.

만약 해당 프로젝트에 파일이 많지 않았다면 주석을 수정하면서 진행했을 테지만, 해당 프로젝트는 파일이 너무 많아서 그럴 수 없었다. 



##### 3. 해결

우선 다국어 지원 세팅을 위해 넣었던 코드를 전부 롤백했다. 이때 생각해둔 방법은 두가지인데 1. 앱 별로 다국어 지원 적용하기 2. 기존 방식 응용이였다. 그런데 장고에는 여러개의 앱 중에서 한개의 앱에만 다국어 지원을 적용하는 기능은 없었고, 무조건 전역으로만 적용할 수 있었다. 그래서 2번째 방식을 선택했다. 

이메일 제목은 짧기 때문에 키: 언어코드(예: en, ko) 밸류: 번역 스트링으로 만들어서 파이선 파일에 저장했다. 리퀘스트를 받으면 유저의 사용 언어 정보도 같이 받아서 언어코드에 해당하는 제목을 내려준다. 이메일 본문에는 html과 스트링이 같이 섞여 있기 때문에 html 파일을 언어별로 저장한다.



##### 4. 후속 조치

시간이 난다면 앞으로 할 후속 조치는 잘못 적힌 인코딩 지정 주석을 싹 다 정리하고 장고 다국어 기능을 사용하는 것이다.



##### References

* https://docs.djangoproject.com/en/3.0/topics/i18n/



